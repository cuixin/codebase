#!/bin/bash

set -e
LUAROCKS=${LUAROCKS:-luarocks}

ROOT="${BASH_SOURCE[0]}";
if([ -h "${ROOT}" ]) then
  while([ -h "${ROOT}" ]) do ROOT=$(readlink "${ROOT}"); done
fi
ROOT=$(cd $(dirname "${ROOT}")/../ && pwd)

NAME="pk-test"

MODULE="pk-test/run"
ROCK_DIR="$(${LUAROCKS} show --rock-dir ${NAME})"
PRIVATE_MODULES_PATH="${ROCK_DIR}/?.lua;${ROOT}/?.lua"

TEST_CASES_PATH="${ROOT}/test/cases"

exec pk-call-lua-module \
  "${PRIVATE_MODULES_PATH}" \
  "${MODULE}" \
  "run" \
  "--root=${ROOT}" \
  "--test-cases-path=${TEST_CASES_PATH}" \
  "$@"
