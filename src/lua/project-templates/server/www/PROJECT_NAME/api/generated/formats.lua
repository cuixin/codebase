--------------------------------------------------------------------------------
-- formats.lua: generated information on url handlers data formats
--------------------------------------------------------------------------------
-- WARNING! Do not change manually.
-- Generated by apigen.lua
--------------------------------------------------------------------------------

local luabins = require 'luabins'

--------------------------------------------------------------------------------

local tkeys,
      tidentityset
      = import 'lua-nucleo/table-utils.lua'
      {
        'tkeys',
        'tidentityset'
      }

local make_xml_schema_builder
      = import 'pk-engine/xml_schema_builder.lua'
      {
        'make_xml_schema_builder'
      }

local make_json_schema_builder
      = import 'pk-engine/json_schema_builder.lua'
      {
        'make_json_schema_builder'
      }

local make_luabins_schema_builder
      = import 'pk-engine/luabins_schema_builder.lua'
      {
        'make_luabins_schema_builder'
      }

local try
      = import 'pk-core/error.lua'
      {
        'try'
      }

local PARTNER_NAMES
      = import 'pk-engine/webservice/partner.lua'
      {
        'PARTNER_NAMES'
      }

local check = import 'pk-engine/webservice/client_api/check.lua' ()

--------------------------------------------------------------------------------

local xml_schema_builder = make_xml_schema_builder()
local json_schema_builder = make_json_schema_builder()
local luabins_schema_builder = make_luabins_schema_builder()

--------------------------------------------------------------------------------

local FORMATS = { }
local BUILDERS = { }
local CLIENT_API_QUERY_URLS = { } -- TODO: Should be in a separate file

--------------------------------------------------------------------------------

-- TODO: ?! Why is it not in some static file, but here, in generated one?
local make_output_format_manager
do
  local build_url_output_format = function(self, url, builder)
    local builder_info = BUILDERS[url]
    if not builder_info then
      return nil, "unknown url " .. tostring(url)
    end

    -- TODO: Support this case in /multiquery anyway (use delayed render)
    if builder_info.output_format_is_dynamic then
      return nil, "cant build dynamic url format for " .. tostring(url)
    end

    if builder_info.output_format_is_raw then
      return nil, "cant build raw url format for " .. tostring(url)
    end

    return builder_info.build_renderer(builder)
  end

  make_output_format_manager = function()

    return
    {
      build_url_output_format = build_url_output_format;
    }
  end
end

--------------------------------------------------------------------------------

return
{
  FORMATS = FORMATS;
  --
  make_output_format_manager = make_output_format_manager;
}
